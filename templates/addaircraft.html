<!--INDY CAF Warbird Booking-->
<!--Jim Olivi 2022-->
{% include "header.html" %}
<script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
<body xmlns="http://www.w3.org/1999/html">
<form method="POST" action="{{ url_for('add_aircraft') }}" enctype="multipart/form-data">
    {{ form.csrf_token }}
    <div class="container-fluid">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <div class="error" id="error_msg"></div>
        <div class="row row-cols-2">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="col d-flex justify-content-center">
                            <div class="form-group">
                                <!--Aircraft Name section-->
                                <h2 class="card-title">Add an Aircraft</h2>
                                <div class="row">
                                    <div class="col-sm-4">
                                        {{ form.aircraft_name }}
                                        {{ form.aircraft_n_number }}
                                        {{ form.aircraft_type }}
                                    </div>
                                    <!-- <Photo Section> -->
                                    <div class="col">
                                        {{ form.aircraft_image_file_name.label }}
                                        {{ form.aircraft_image_file_name }}
                                    </div>
                                    <div class="row">
                                        <div class="col align-self-center text-center">
                                            <img id="aircraft_display" src="" class="text-center airplane-image"
                                                 alt="Aircraft Image">
                                        </div>
                                    </div>
                                    <script>
                                        $('#aircraft_image_file_name').change(function () {
                                            console.log('Go get the image')
                                            const aircraft_file = aircraft_image_file_name.files[0]
                                            console.log(aircraft_file.name)
                                            const photo_src = URL.createObjectURL(aircraft_file)
                                            console.log(`File name: ${photo_src}`)
                                            $("#aircraft_display").attr("src", photo_src)
                                            aircraft_image_file_name.data = aircraft_file
                                        })
                                    </script>
                                    <div class="btn-group-toggle" data-toggle="buttons">
                                        {{ form.operational }}
                                        {{ form.operational.label }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-auto">
                                {{ form.add_aircraft }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>
</body>
<script>
    // Do the final checking before allowing the screen to submit
    $("form").submit(function (event) {
        const regexp = /^\w+$/;
        const text = $("#aircraft_n_number").first().val()
        if (regexp.test(text)) {
            return;
        } else {
            $('')
            console.log('Submit prevented')
            $("#error_msg").first().text("Aircraft N Numbers: capital letters and numbers only.")
            event.preventDefault();
        }
    });
</script>
{% include "footer.html" %}